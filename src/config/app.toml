# ==================================================
# app.toml â€” minimal pipeline app config
# ==================================================

id = "market-ingest"
env = "prod"
config_version = 1
redis_enabled = true

# if db is disabled at the start, then db batch will always be with default parameters you cant change it at runtime
[db]
enabled = true
verify = true

[redis]
enabled = true

# --------------------------------------------------
# Fixed-point scaling (canonical representation)
# All integer values stored as: real_value * scale
# for the sake of saving disk space
# --------------------------------------------------
[scales]
price = 100000000        # 1e8  (supports tiny prices like 0.0000023)
qty = 100000000          # 1e8
open_interest = 100000000
funding = 1000000000000  # 1e12

# --------------------------------------------------
# Exchange toggles
# --------------------------------------------------
[exchange_toggles]
binance_linear = true
hyperliquid_perp = true
bybit_linear = true

# --------------------------------------------------
# Stream routing behavior
# --------------------------------------------------
[streams]
ws_reconnect_backoff_initial_ms = 500
ws_reconnect_backoff_max_ms     = 30000
ws_reconnect_trip_after_failures = 10
ws_reconnect_cooldown_seconds   = 120

# --------------------------------------------------
# Safety limits
# --------------------------------------------------
[limits]
max_active_streams = 500
max_events_per_sec = 500000

# --------------------------------------------------
# Logging
# --------------------------------------------------
[logging]
level = "info"

# --------------------------------------------------
# Metrics
# --------------------------------------------------
[metrics]
enabled = true

# --------------------------------------------------
# Runtime health (process self-protection)
# --------------------------------------------------
[health]
enabled = true

[health.runtime]
enabled = true
poll_interval_ms = 1000
hold_down_ms = 3000

# Memory (RAM)
max_rss_mb_red = 14000
min_avail_mem_mb_red = 800

# File descriptors (sockets, files, etc.)
fd_pct_red = 90

# Tokio runtime overload (scheduler latency / drift)
tick_drift_ms_red = 200
drift_sustain_ticks = 5

# CPU sustained overload
cpu_pct_red = 95
cpu_sustain_sec = 10

